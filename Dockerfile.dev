# Development Dockerfile with hot-reload support

FROM node:20-alpine

WORKDIR /app

# Install development tools
RUN apk add --no-cache git curl bash

# Copy package files
COPY package*.json ./
COPY hyperdeploy/package*.json ./hyperdeploy/
COPY cdn/package*.json ./cdn/
COPY resolver/package*.json ./resolver/
COPY registry-sync/package*.json ./registry-sync/

# Install all dependencies
RUN npm ci --prefer-offline && \
    cd hyperdeploy && npm ci --prefer-offline && cd .. && \
    cd cdn && npm ci --prefer-offline && cd .. && \
    cd resolver && npm ci --prefer-offline && cd .. && \
    cd registry-sync && npm ci --prefer-offline && cd ..

# Copy source
COPY . .

EXPOSE 3000 8080 6379

ENV NODE_ENV=development

CMD ["npm", "run", "dev"]
